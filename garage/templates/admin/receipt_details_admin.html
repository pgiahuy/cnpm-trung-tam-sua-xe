{% extends 'admin/master.html' %}

{% block body %}
<div class="container mt-4" id="print-area" style="background:white; padding:20px">

    {% if receipt.type == "BUY" %}
    <h2 class="text-center mb-4">HÓA ĐƠN MUA HÀNG</h2>
    {% else %}
    <h2 class="text-center mb-4">HÓA ĐƠN SỬA CHỮA</h2>
    {% endif %}

    <div class="card mb-3">
        <div class="card-body">
            <div class="row table-light">

                <div class="col-md-6">
                    <p><strong>Khách hàng</strong></p>
                    <p>Tên: {{ receipt.customer.full_name }}</p>
                    <p>SĐT: {{ receipt.customer.phone }}</p>
                    <p>Email: {{ receipt.customer.email }}</p>
                </div>

                <div class="col-md-6 text-end">
                    <p><strong>Hóa đơn</strong></p>
                    <p><strong>GARAGE CENTER</strong></p>
                    <p>Mã HĐ: HD{{ receipt.id }}</p>
                    <p>
                        Loại:
                        {{ 'Sửa chữa' if receipt.type == 'REPAIR' else 'Mua hàng' }}
                    </p>
                </div>

            </div>
        </div>
    </div>

    <div class="card mb-3">
        <div class="card-body p-0">
            <table class="table table-bordered mb-0">
                <thead class="table-light">
                <tr>
                    <th></th>
                    <th>Tên</th>
                    <th>Loại</th>
                    <th class="text-center">Số lượng</th>
                    <th class="text-end">Đơn giá</th>
                    <th class="text-end">Thành tiền</th>
                </tr>
                </thead>
                <tbody>
                {% for item in receipt.items %}
                <tr>
                    <td>{{ loop.index }}</td>
                    <td>
                        {% if item.service %}
                        {{ item.service.name }}
                        {% elif item.spare_part %}
                        {{ item.spare_part.name }}
                        {% endif %}
                    </td>
                    {% if item.item_type.name == 'SERVICE'%}
                    <td>Tiền công</td>
                    {% else %}
                    <td>Phụ tùng</td>
                    {%endif%}

                    <td class="text-center">{{ item.quantity }}</td>
                    <td class="text-end">{{ "{:,.0f}".format(item.unit_price) }} ₫</td>
                    <td class="text-end">{{ "{:,.0f}".format(item.total_price) }} ₫</td>
                </tr>
                {% endfor %}
                </tbody>
            </table>
        </div>
    </div>

    <div class="card">
        <div class="card-body">
            <div class="row justify-content-between">
                <div class="col-md-4">
                    <p class="d-flex justify-content-between">
                        <span>Tạm tính:</span>
                        <strong>{{ "{:,.0f}".format(receipt.subtotal) }} ₫</strong>
                    </p>
                    <p class="d-flex justify-content-between">
                        <span>VAT ({{ receipt.vat_rate * 100 }}%):</span>
                        <strong>{{ "{:,.0f}".format(receipt.subtotal * receipt.vat_rate) }} ₫</strong>
                    </p>
                    <hr>
                    <p class="d-flex justify-content-between fs-5">
                        <span>Tổng thanh toán:</span>
                        <strong class="text-danger">{{ "{:,.0f}".format(receipt.total_paid) }} ₫</strong>
                    </p>
                </div>

                <div class="col-md-4 mt-3 mt-md-0">
                    <div class="border border-danger rounded p-3 text-center">
                        <h4 class="text-danger mb-2 fw-bold">ĐÃ THANH TOÁN</h4>
                        <p class="mb-1">
                            <strong>Ngày:</strong>
                            {{ receipt.paid_at.strftime('%d/%m/%Y %H:%M') }}
                        </p>
                        <p class="mb-0">
                            <strong>PTTT:</strong> {{ receipt.payment_method }}
                        </p>
                    </div>

                    <div class="text-end mt-3 no-print">
                        <button class="btn btn-outline-primary" onclick="window.print()">
                            In hóa đơn
                        </button>
                    </div>
                </div>
            </div>
        </div>
    </div>

</div>

<style>
    @media print {
        body * {
            visibility: hidden;
        }
        #print-area, #print-area * {
            visibility: visible;
        }
        #print-area {
            position: absolute;
            left: 0;
            top: 0;
            width: 100% !important;
        }
        .no-print {
            display: none !important;
        }
    }
</style>
{% endblock %}
