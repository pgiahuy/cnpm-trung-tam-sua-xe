{% extends "layout/base.html" %}

{% block content %}
<div class="container mt-5" style="max-width: 600px;">
    <h2 class="text-center mb-4 fw-bold">Chỉnh sửa hồ sơ</h2>

    <form method="post" enctype="multipart/form-data">
        <div class="card shadow-sm border-1">
            <div class="card-body">

                <!-- Avatar -->
                <div class="text-center mb-4">
                    <img id="avatarPreview"
                         src="{{ user.avatar or url_for('static', filename='images/default-avatar.png') }}"
                         class="rounded-circle shadow-sm"
                         width="130"
                         height="130"
                         style="object-fit: cover; border: 3px solid #0d6efd;">

                    <div class="mt-3">
                        <label class="btn btn-outline-primary btn-sm">
                            <i class="fa-solid fa-upload me-1"></i> Chọn ảnh
                            <input type="file"
                                   name="avatar"
                                   id="avatarInput"
                                   class="d-none"
                                   accept="image/png, image/jpeg, image/jpg, image/gif">
                        </label>
                    </div>
                </div>

                <!-- Full name -->
                <div class="mb-3">
                    <label class="form-label fw-semibold">Họ và tên</label>
                    <input type="text"
                           name="full_name"
                           class="form-control"
                           value="{{ user.customer.full_name }}"
                           required>
                </div>

                <!-- Phone -->
                <div class="mb-3">
                    <label class="form-label fw-semibold">Số điện thoại</label>
                    <input type="text"
                           name="phone"
                           class="form-control"
                           value="{{ user.customer.phone }}"
                           readonly>
                </div>

                <div class="mb-3">
                    <label class="form-label fw-semibold">Email</label>
                    <input type="text"
                           name="phone"
                           class="form-control"
                           value="{{ user.customer.email}}"
                           readonly>
                </div>

                <!-- Address -->
                <div class="mb-3">
                    <label class="form-label fw-semibold">Địa chỉ</label>
                    <input type="text"
                           name="address"
                           class="form-control"
                           value="{{ user.customer.address }}">
                </div>

                <!-- Buttons -->
                <div class="d-flex justify-content-between mt-4">
                    <a href="{{ url_for('user_profile') }}" class="btn btn-secondary">
                        Quay lại
                    </a>
                    <button type="submit" class="btn btn-primary">
                        <i class="fa-solid fa-save me-1"></i> Lưu thay đổi
                    </button>
                </div>

            </div>
        </div>
    </form>
</div>

<script>
    document.getElementById('avatarInput').addEventListener('change', function(e){
        const [file] = e.target.files;
        if(file){
            const allowedTypes = ['image/jpeg','image/png','image/jpg','image/gif'];
            if(!allowedTypes.includes(file.type)){
                alert('Chỉ được chọn file ảnh (jpg, jpeg, png, gif)');
                e.target.value = '';
                return;
            }
            const preview = document.getElementById('avatarPreview');
            preview.src = URL.createObjectURL(file);
        }
    });
</script>
{% endblock %}
